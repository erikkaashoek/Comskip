clone_depth: 5

platform:
  - x64

before_build:
  - git log -1
  - cd C:\projects\comskip
  - appveyor DownloadFile http://ffmpeg.zeranoe.com/builds/win32/dev/ffmpeg-2.8.6-win32-dev.7z
  - 7z x ffmpeg-2.8.6-win32-dev.7z

build_script:
  - C:\msys64\usr\bin\bash -lc "export PATH=/mingw32/bin/:$PATH && echo $PATH && gcc -v"
  - C:\msys64\usr\bin\bash -lc "export PATH=/mingw32/bin/:$PATH && cd /c/projects/comskip && ./autogen.sh && argtable2_CFLAGS='-Ivendor' argtable2_LIBS='-Lvendor -largtable2' ffmpeg_CFLAGS='-Iffmpeg-2.8.6-win32-dev/include' ffmpeg_LIBS='-Lffmpeg-2.8.6-win32-dev/lib -lavutil -lavformat -lavcodec' ./configure --build=i686-w64-mingw32 && make"

before_test:
  - appveyor DownloadFile https://s3.amazonaws.com/tmm1/ten-copy.mkv

test_script:
  - comskip ten-copy.mkv
  - C:\msys64\usr\bin\bash -lc "cat ten-copy.txt"
  - C:\msys64\usr\bin\bash -lc 'grep "9359	17920" ten-copy.txt'
