clone_depth: 5

platform:
  - x64

init:
  - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))

before_build:
  - git log -1
  - cd C:\projects\comskip
  - appveyor DownloadFile http://ffmpeg.zeranoe.com/builds/win64/dev/ffmpeg-2.8.6-win64-dev.7z
  - 7z x ffmpeg-2.8.6-win64-dev.7z

build_script:
  - C:\msys64\usr\bin\bash -lc "export cd /c/projects/comskip && ./autogen.sh && argtable2_CFLAGS='-Ivendor' argtable2_LIBS='-Lvendor -largtable2' ffmpeg_CFLAGS='-Iffmpeg-2.8.6-win64-dev/include' ffmpeg_LIBS='-Lffmpeg-2.8.6-win64-dev/lib -lavutil -lavformat -lavcodec' ./configure && make"

before_test:
  - C:\msys64\usr\bin\bash -lc "cd /c/projects/comskip && export PATH=$(pwd)/vendor/:$(pwd)/ffmpeg-2.8.6-win64-dev/lib/:$PATH && ls -alh comskip.exe && ldd comskip.exe"
#  - appveyor DownloadFile https://s3.amazonaws.com/tmm1/ten-copy.mkv
#
#test_script:
#  - comskip ten-copy.mkv
#  - C:\msys64\usr\bin\bash -lc "cat ten-copy.txt"
#  - C:\msys64\usr\bin\bash -lc 'grep "9359	17920" ten-copy.txt'
